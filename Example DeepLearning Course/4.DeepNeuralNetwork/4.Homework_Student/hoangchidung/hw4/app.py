from flask import Flask, request, render_template, jsonify
from flask_cors import CORS
from predict import *
from utils import preprocessing

app = Flask(__name__)
CORS(app)


@app.route("/predict", methods=["GET", "POST"])
def predict_label():
    if request.method == "GET":
        return render_template("index.html")
    if request.method == "POST":
        age = request.form.get('age')
        final_weight = request.form.get('final_weight')
        total_education_yrs = request.form.get('total_education_yrs')
        capital_gain = request.form.get('capital_gain')
        capital_loss = request.form.get('capital_loss')
        hrs_per_week = request.form.get('hrs_per_week')
        x7 = request.form.get('7')
        x8 = request.form.get('8')
        x9 = request.form.get('9')
        x10 = request.form.get('10')
        x11 = request.form.get('11')
        x12 = request.form.get('12')
        x13 = request.form.get('13')
        x14 = request.form.get('14')
        x15 = request.form.get('15')
        x16 = request.form.get('16')
        x17 = request.form.get('17')
        x18 = request.form.get('18')
        x19 = request.form.get('19')
        x20 = request.form.get('20')
        x21 = request.form.get('21')
        x22 = request.form.get('22')
        x23 = request.form.get('23')
        x24 = request.form.get('24')
        x25 = request.form.get('25')
        x26 = request.form.get('26')
        x27 = request.form.get('27')
        x28 = request.form.get('28')
        x29 = request.form.get('29')
        x30 = request.form.get('30')
        x31 = request.form.get('31')
        x32 = request.form.get('32')
        x33 = request.form.get('33')
        x34 = request.form.get('34')
        x35 = request.form.get('35')
        x36 = request.form.get('36')
        x37 = request.form.get('37')
        x38 = request.form.get('38')
        x39 = request.form.get('39')
        x40 = request.form.get('40')
        x41 = request.form.get('41')
        x42 = request.form.get('42')
        x43 = request.form.get('43')
        x44 = request.form.get('44')
        x45 = request.form.get('45')
        x46 = request.form.get('46')
        x47 = request.form.get('47')
        x48 = request.form.get('48')
        x49 = request.form.get('49')
        x50 = request.form.get('50')
        x51 = request.form.get('51')
        x52 = request.form.get('52')
        x53 = request.form.get('53')
        x54 = request.form.get('54')
        x55 = request.form.get('55')
        x56 = request.form.get('56')
        x57 = request.form.get('57')
        x58 = request.form.get('58')
        x59 = request.form.get('59')
        x60 = request.form.get('60')
        x61 = request.form.get('61')
        x62 = request.form.get('62')
        x63 = request.form.get('63')
        x64 = request.form.get('64')
        x65 = request.form.get('65')
        x66 = request.form.get('66')
        x67 = request.form.get('67')
        x68 = request.form.get('68')
        x69 = request.form.get('69')
        x70 = request.form.get('70')
        x71 = request.form.get('71')
        x72 = request.form.get('72')
        x73 = request.form.get('73')
        x74 = request.form.get('74')
        x75 = request.form.get('75')
        x76 = request.form.get('76')
        x77 = request.form.get('77')
        x78 = request.form.get('78')
        x79 = request.form.get('79')
        x80 = request.form.get('80')
        x81 = request.form.get('81')
        x82 = request.form.get('82')
        x83 = request.form.get('83')
        x84 = request.form.get('84')
        x85 = request.form.get('85')
        x86 = request.form.get('86')
        x87 = request.form.get('87')
        x88 = request.form.get('88')
        x89 = request.form.get('89')
        x90 = request.form.get('90')
        x91 = request.form.get('91')
        x92 = request.form.get('92')
        x93 = request.form.get('93')
        x94 = request.form.get('94')
        x95 = request.form.get('95')
        x96 = request.form.get('96')
        x97 = request.form.get('97')
        x98 = request.form.get('98')
        x99 = request.form.get('99')
        x100 = request.form.get('100')
        x101 = request.form.get('101')
        x102 = request.form.get('102')
        x103 = request.form.get('103')
        x104 = request.form.get('104')
        x105 = request.form.get('105')

        X1 = np.array([[age, final_weight, total_education_yrs, capital_gain, capital_loss, hrs_per_week]])
        X1_tf = preprocessing(X1)

        X2 = np.array([[x7, x8, x9, x10, x11, x12, x13, x14, x15, x16, x17, x18, x19, x20, x21, x22, x23]])
        X3 = np.array([[x24, x25, x26, x27, x28, x29, x30, x31, x32, x33, x34, x35, x36, x37, x38, x39]])
        X4 = np.array([[x40, x41, x42, x43, x44, x45, x46, x47, x48, x49, x50, x51, x52, x53, x54, x55]])
        X5 = np.array([[x56, x57, x58, x59, x60, x61, x62, x63, x64, x65, x66, x67, x68, x69, x70, x71]])
        X6 = np.array([[x72, x73, x74, x75, x76, x77, x78, x79, x80, x81, x82, x83, x84, x85, x86, x87]])
        X7 = np.array(
            [[x88, x89, x90, x91, x92, x93, x94, x95, x96, x97, x98, x99, x100, x101, x102, x103, x104, x105]])

        X = np.concatenate((X1_tf, X2, X3, X4, X5, X6, X7), axis=1)
        X = torch.Tensor(X)
        label = predict(X)

        return jsonify(predictions=label)


if __name__ == "__main__":
    app.run(debug=True)
